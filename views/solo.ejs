<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SUDOKU SOLO</title>
    <link rel="stylesheet" href="nav.css"/>
    <style>
        *{
            text-align: center;
            font-weight: 400;
            font-size: 18px;
            font-family: Georgia, serif;
        }
        body{
            background-image: url("https://4.bp.blogspot.com/-dXMb3OIPqiw/UV5pkcbDQhI/AAAAAAAACP0/8hPOunZvj7g/s1600/3.jpg");
        }
        h1{
            background: linear-gradient(to bottom, rgba(255,255,255,1) 0%,rgba(255,255,255,0) 100%);
            text-align:center;
            font-family: Georgia, serif;
            font-size: 40px;
            letter-spacing: 3.8px;
            word-spacing: 5.6px;
            color: #000000;
            font-weight: 400;
            text-decoration: none solid rgb(68, 68, 68);
            font-style: italic;
            font-variant: small-caps;
            text-transform: none;
        }
        button {
            margin: 0 auto;
            box-shadow: 0 9px 26px 18px #57ff29;
            background: #ff0000 linear-gradient(to bottom, #ff0000 5%, #e3b600 100%);
            display:block;
            cursor:pointer;
            color:#ffffff;
            font-size:28px;
            font-weight: 400;
            padding:17px 18px;
            text-decoration:none;
        }
        button:hover {
            background: #e3b600 linear-gradient(to bottom, #e3b600 5%, #ff0000 100%);
            text-shadow:0 -1px 7px #ffffff;
        }
        #difficulties button{
            display: inline-block;
            font-size: 22px;
            margin-right: 20px;
            margin-left: 20px;
        }
        table{
            margin: auto;
        }
        #board{
            padding: 4%;
            display: none;
        }
        input{
            background: linear-gradient(to bottom,  rgba(230,240,163,1) 0%,rgba(210,230,56,1) 50%,rgba(195,216,37,1) 51%,rgba(219,240,67,1) 100%);
            border:0;
            text-align:center;
            font-size:24px;
            font-family: Georgia, serif;
            width:55px;
            height:55px;
            padding: 0;
        }
        tr:first-child td {
            border-top-color: #000000;
            border-top-width: 5px;
        }
        tr:nth-child(3n) td {
            border-bottom-color: #000000;
            border-bottom-width: 5px;
        }
        td{
            border: 1px solid grey;
        }
        td:first-child {
            border-left-color: #000000;
            border-left-width: 5px;
        }
        td:nth-child(3n) {
            border-right-color: #000000;
            border-right-width: 5px;
        }
        input:hover {
            background: #ffffff;
        }
        #timer{
            position: fixed;
            float: left;
            top: 70px;
            margin: 5%;
            display: none;
        }
        #solved{
            display: none;
        }
    </style>
    <script src="sudoku.js"></script>

</head>
<body>
<div class="topnav">
    <%if(logged){%>
        <a href="welcome">Welcome, <%=pname%></a>
        <a href="logout">LogOut</a>
        <a href="help">Tutorial and FAQ</a>
        <a href="lobby">Play with friends</a>
        <a class="active" href="solo">Play Solo</a>
    <%}else{%>
        <a href="welcome">Home</a>
        <a href="login.html">LogIn</a>
        <a href="signup.html">SignUp</a>
        <a href="help">Tutorial and FAQ</a>
        <a href="lobby">Play Online as Guest</a>
        <a class="active" href="solo">Play Solo as Guest</a>
    <%}%>
</div>
<h1>SUDOKU SOLO</h1>
<div id="difficulties">
    <button id="easy">easy</button>
    <button id="medium">medium</button>
    <button id="hard">hard</button>
</div>
<h1 id="solved"></h1>
<div id="board">
    <table id="grid">
        <tr><td><input value="0" class="cell" type="button"  id="1"></td>
            <td><input value="0" class="cell" type="button"  id="2"></td>
            <td><input value="0" class="cell" type="button"  id="3"></td>
            <td><input value="0" class="cell" type="button"  id="4"></td>
            <td><input value="0" class="cell" type="button"  id="5"></td>
            <td><input value="0" class="cell" type="button"  id="6"></td>
            <td><input value="0" class="cell" type="button"  id="7"></td>
            <td><input value="0" class="cell" type="button"  id="8"></td>
            <td><input value="0" class="cell" type="button"  id="9"></td></tr>
        <tr><td><input value="0" class="cell" type="button"  id="10"></td>
            <td><input value="0" class="cell" type="button"  id="11"></td>
            <td><input value="0" class="cell" type="button"  id="12"></td>
            <td><input value="0" class="cell" type="button"  id="13"></td>
            <td><input value="0" class="cell" type="button"  id="14"></td>
            <td><input value="0" class="cell" type="button"  id="15"></td>
            <td><input value="0" class="cell" type="button"  id="16"></td>
            <td><input value="0" class="cell" type="button"  id="17"></td>
            <td><input value="0" class="cell" type="button"  id="18"></td></tr>
        <tr><td><input value="0" class="cell" type="button"  id="19"></td>
            <td><input value="0" class="cell" type="button"  id="20"></td>
            <td><input value="0" class="cell" type="button"  id="21"></td>
            <td><input value="0" class="cell" type="button"  id="22"></td>
            <td><input value="0" class="cell" type="button"  id="23"></td>
            <td><input value="0" class="cell" type="button"  id="24"></td>
            <td><input value="0" class="cell" type="button"  id="25"></td>
            <td><input value="0" class="cell" type="button"  id="26"></td>
            <td><input value="0" class="cell" type="button"  id="27"></td></tr>
        <tr><td><input value="0" class="cell" type="button"  id="28"></td>
            <td><input value="0" class="cell" type="button"  id="29"></td>
            <td><input value="0" class="cell" type="button"  id="30"></td>
            <td><input value="0" class="cell" type="button"  id="31"></td>
            <td><input value="0" class="cell" type="button"  id="32"></td>
            <td><input value="0" class="cell" type="button"  id="33"></td>
            <td><input value="0" class="cell" type="button"  id="34"></td>
            <td><input value="0" class="cell" type="button"  id="35"></td>
            <td><input value="0" class="cell" type="button"  id="36"></td></tr>
        <tr><td><input value="0" class="cell" type="button"  id="37"></td>
            <td><input value="0" class="cell" type="button"  id="38"></td>
            <td><input value="0" class="cell" type="button"  id="39"></td>
            <td><input value="0" class="cell" type="button"  id="40"></td>
            <td><input value="0" class="cell" type="button"  id="41"></td>
            <td><input value="0" class="cell" type="button"  id="42"></td>
            <td><input value="0" class="cell" type="button"  id="43"></td>
            <td><input value="0" class="cell" type="button"  id="44"></td>
            <td><input value="0" class="cell" type="button"  id="45"></td></tr>
        <tr><td><input value="0" class="cell" type="button"  id="46"></td>
            <td><input value="0" class="cell" type="button"  id="47"></td>
            <td><input value="0" class="cell" type="button"  id="48"></td>
            <td><input value="0" class="cell" type="button"  id="49"></td>
            <td><input value="0" class="cell" type="button"  id="50"></td>
            <td><input value="0" class="cell" type="button"  id="51"></td>
            <td><input value="0" class="cell" type="button"  id="52"></td>
            <td><input value="0" class="cell" type="button"  id="53"></td>
            <td><input value="0" class="cell" type="button"  id="54"></td></tr>
        <tr><td><input value="0" class="cell" type="button"  id="55"></td>
            <td><input value="0" class="cell" type="button"  id="56"></td>
            <td><input value="0" class="cell" type="button"  id="57"></td>
            <td><input value="0" class="cell" type="button"  id="58"></td>
            <td><input value="0" class="cell" type="button"  id="59"></td>
            <td><input value="0" class="cell" type="button"  id="60"></td>
            <td><input value="0" class="cell" type="button"  id="61"></td>
            <td><input value="0" class="cell" type="button"  id="62"></td>
            <td><input value="0" class="cell" type="button"  id="63"></td></tr>
        <tr><td><input value="0" class="cell" type="button"  id="64"></td>
            <td><input value="0" class="cell" type="button"  id="65"></td>
            <td><input value="0" class="cell" type="button"  id="66"></td>
            <td><input value="0" class="cell" type="button"  id="67"></td>
            <td><input value="0" class="cell" type="button"  id="68"></td>
            <td><input value="0" class="cell" type="button"  id="69"></td>
            <td><input value="0" class="cell" type="button"  id="70"></td>
            <td><input value="0" class="cell" type="button"  id="71"></td>
            <td><input value="0" class="cell" type="button"  id="72"></td></tr>
        <tr><td><input value="0" class="cell" type="button"  id="73"></td>
            <td><input value="0" class="cell" type="button"  id="74"></td>
            <td><input value="0" class="cell" type="button"  id="75"></td>
            <td><input value="0" class="cell" type="button"  id="76"></td>
            <td><input value="0" class="cell" type="button"  id="77"></td>
            <td><input value="0" class="cell" type="button"  id="78"></td>
            <td><input value="0" class="cell" type="button"  id="79"></td>
            <td><input value="0" class="cell" type="button"  id="80"></td>
            <td><input value="0" class="cell" type="button"  id="81"></td></tr>
    </table>
</div>
<h1 id="timer">00:00:00</h1>
</body>
<script>
    //GLOBAL VARIABLES
    let perzle = "";
    let puzzle = "";
    let curcell = "1";
    let start = Date.now();
    let taken = 0;
    let timer = 0;

    //UTILITY FUNCTIONS
    function to_grid(board_string){
        var rows = [];
        var cur_row = [];
        for(var i in board_string){
            cur_row.push(board_string[i]);
            if(i % 9 == 8){
                rows.push(cur_row);
                cur_row = [];
            }
        }
        return rows;
    }
    function setCharAt(str,index,chr) {
        if(index > str.length-1) return str;
        return str.substr(0,index) + chr + str.substr(index+1);
    }
    function checkSudoku(board){
        const isSudokuArrayValid = (array) => {
            const row = array.slice(0).sort().join(''),
                passingRow = [1,2,3,4,5,6,7,8,9].join('');

            return (row === passingRow);
        };

        const testRows = (board) => board.every(row => isSudokuArrayValid(row));

        const testColumns = (board) => {
            const gatherColumn = (board, columnNum) => board.reduce((total, row) => [...total, row[columnNum]], []);
            return [0,1,2,3,4,5,6,7,8].every(i => isSudokuArrayValid(gatherColumn(board, i)));
        };

        const testSquares = (board) => {
            const getSquareIndexes = (num) => {
                if (num === 1) {
                    return [0,1,2];
                } else if (num === 2) {
                    return [3,4,5];
                } else {
                    return [6,7,8];
                }
            };

            const getSquareValues = (x, y, board) => {
                let values = [],
                    rows = getSquareIndexes(x),
                    columns = getSquareIndexes(y);

                rows.forEach(row => {
                    columns.forEach(column => {
                        values.push(board[row][column]);
                    });
                });

                return values;
            };

            const squareSections = [1,2,3];
            return squareSections.every(squareX => {
                return squareSections.every(squareY => isSudokuArrayValid(getSquareValues(squareX, squareY, board)));
            });
        };

        return (testRows(board) && testColumns(board) && testSquares(board)) ? true : false;
    }
    function dtostr(msec) {
        var hh = Math.floor(msec / 1000 / 60 / 60);
        msec -= hh * 1000 * 60 * 60;
        var mm = Math.floor(msec / 1000 / 60);
        msec -= mm * 1000 * 60;
        var ss = Math.floor(msec / 1000);
        msec -= ss * 1000;
        return hh + ":" + mm + ":" + ss;
    }

    //DOM FUNCTIONS
    function renderPerzle(){
        for(let i=0;i<81;i++){
            document.getElementById(i+1+"").value=puzzle[i];
            if(perzle.charAt(i)!=="."){
                document.getElementById(i+1+"").style.color="red";
                document.getElementById(i+1+"").style.background = "linear-gradient(to bottom, rgba(252,234,187,1) 0%, rgba(252,205,77,1) 50%, rgba(248,181,0,1) 51%, rgba(251,223,147,1) 100%)";
            }else{
                document.getElementById(i+1+"").style.color="black";
                document.getElementById(i+1+"").style.background = "linear-gradient(to bottom,  rgba(230,240,163,1) 0%,rgba(210,230,56,1) 50%,rgba(195,216,37,1) 51%,rgba(219,240,67,1) 100%)";
            }
        }
    }
    function timeIt(){
        document.getElementById("timer").innerText=dtostr(Date.now()-start)+"";
    }
    function restoreButtons(){
        document.getElementById("easy").style.background = "#ff0000 linear-gradient(to bottom, #ff0000 5%, #e3b600 100%)";
        document.getElementById("medium").style.background = "#ff0000 linear-gradient(to bottom, #ff0000 5%, #e3b600 100%)";
        document.getElementById("hard").style.background = "#ff0000 linear-gradient(to bottom, #ff0000 5%, #e3b600 100%)";
    }

    //HANDLERS
    document.getElementById("difficulties").addEventListener("click",function (event) {
        if(event.target.tagName === "BUTTON"){
            restoreButtons();
            event.target.style.background = "linear-gradient(to bottom, rgba(210,223,237,1) 0%,rgba(200,215,235,1) 26%,rgba(190,208,234,1) 51%,rgba(166,192,227,1) 51%,rgba(175,199,232,1) 62%,rgba(186,208,239,1) 75%,rgba(153,181,219,1) 88%,rgba(121,155,200,1) 100%)";
            perzle = sudoku.generate(event.target.id);
            puzzle = perzle;
            renderPerzle();
            start = Date.now();
            document.getElementById("board").style.display = "block";
            document.getElementById("timer").style.display = "block";
            timer = setInterval(timeIt,1000);
            document.getElementById("solved").style.display = "none";
        }
    });
    document.getElementById("grid").addEventListener("click",function (event) {
        renderPerzle();
        if(event.target.tagName === "INPUT"){
            curcell = event.target.id;
            document.getElementById(event.target.id).style.color = "blue";
            document.getElementById(event.target.id).style.background = "white";
        }
    });
    document.addEventListener("keypress", function (event) {
        if(perzle.charAt(parseInt(curcell-1))==="." && ((event.key >= '0' && event.key <= '9') || event.key===".")){
            curval = event.key;
            document.getElementById(curcell).value = event.key;
            puzzle = setCharAt(puzzle,parseInt(curcell)-1,event.key);
            if(checkSudoku(to_grid(puzzle))){
                taken = Date.now()-start;
                clearInterval(timer);
                timer = 0;
                document.getElementById("solved").innerHTML = "SOLVED IN "+dtostr(taken)+"!";
                document.getElementById("solved").style.display = "block";
            }
        }
    });

</script>
</html>